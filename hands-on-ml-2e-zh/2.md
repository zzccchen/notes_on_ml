# 二、端到端的机器学习项目

## 项目概览

### 划定问题

### 选择性能指标

#### 均方根误差

回归问题的典型指标是均方根误差（RMSE）。均方根误差测量的是系统预测误差的标准差。

例如，RMSE 等于 50000，意味着，68% 的系统预测值位于实际值的 50000 美元以内，95% 的预测值位于实际值的 100000 美元以内。

一个特征通常都符合高斯分布，即满足 “68-95-99.7”规则：大约 68% 的值落在`1σ`内，95% 的值落在`2σ`内，99.7% 的值落在`3σ`内，这里的`σ`等于 50000。

![](img/e-2-1.png)

公式 2-1 均方根误差（RMSE）

> 符号的含义
>
> 这个方程引入了一些常见的贯穿本书的机器学习符号：
>
> * `m`是测量 RMSE 的数据集中的实例数量。  
>     例如，如果用一个含有 2000 个街区的验证集求 RMSE，则`m = 2000`。
>
> * `x^(i)`是数据集第`i`个实例的所有特征值（不包含标签）的向量，`y^(i)`是它的标签（这个实例的输出值）。 
>
>     例如，如果数据集中的第一个街区位于经度 –118.29°，纬度 33.91°，有 1416 名居民，收入中位数是 38372 美元，房价中位数是 156400 美元（忽略掉其它的特征），则有：  
>
>     ![](img/o-2-1.png)
>
>     和，  
>
>     ![](img/o-2-2.png)
>
> * `X`是包含数据集中所有实例的所有特征值（不包含标签）的矩阵。每一行是一个实例，第`i`行是`x^(i)`的转置，记为`x^(i)^T`。
>
>   例如，仍然是前面提到的第一区，矩阵`X`就是：  
>
>     ![](img/o-2-3.png)
>
> * `h`是系统的预测函数，也称为假设（hypothesis）。当系统收到一个实例的特征向量`x^(i)`，就会输出这个实例的一个预测值`y_hat = h(x^(i))`（`y_hat`读作`y-hat`）。  
>
>     例如，如果系统预测第一区的房价中位数是 158400 美元，则`y_hat^(1) = h(x^(1)) = 158400`。预测误差是 `y_hat^(1) - y^(1) = 2000`。
>
> *   `RMSE(X,h)`是使用假设`h`在样本集上测量的损失函数。
>
> 我们使用小写斜体表示标量值（例如`m`或`y^(i)`）和函数名（例如`h`），小写粗体表示向量（例如`x^(i)`），大写粗体表示矩阵（例如`X`）。

#### 平均绝对误差

虽然大多数时候 RMSE 是回归任务可靠的性能指标，在有些情况下，你可能需要另外的函数。例如，假设存在许多异常的街区。此时，你可能需要使用平均绝对误差（Mean Absolute Error，也称作平均绝对偏差），见公式 2-2：

![](img/e-2-2.png)

公式 2-2 平均绝对误差

#### 范数

向量的范数可以简单形象的理解为向量的长度，或者向量到零点的距离，或者相应的两个点之间的距离。

常用的向量的范数：

*   L0 范数（汉明范数）：为 x 向量各个非零元素的个数；
*   L1 范数（曼哈顿范数）：为 x 向量中非零元素的绝对值之和；
*   L2 范数（欧几里得（Euclidean）范数）：为 x 向量各个元素平方和的 1/2 次方。L2 范数是最常见的两点之间或多点之间的距离表示法，又称 Frobenius 范数；
*   Lk 范数（K 阶闵氏范数）：为 x 向量各个元素绝对值 k 次方和的 1/k 次方；
*   L∞范数（切比雪夫范数）：为 x 向量各个元素绝对值最大那个元素的绝对值，如下：`|x|∞=max(|x1|,|x2|,…,|xn|)`；
*   范数的指数越高，就越关注大的值而忽略小的值。这就是为什么 RMSE 比 MAE 对异常值更敏感。但是当异常值是指数分布的（类似正态曲线），RMSE 就会表现很好。

### 核实假设

## 获取数据

### 创建工作空间

### 下载数据

### 快速查看数据结构

### 创建测试集

#### 纯随机的取样方法

理论上，创建测试集很简单：只要随机挑选一些实例，一般是数据集的 20%。

这个方法可行，但是并不完美：如果再次运行程序，就会产生一个不同的测试集！多次运行之后，你（或你的机器学习算法）就会得到整个数据集，这是需要避免的。

解决的办法之一是保存第一次运行得到的测试集，并在随后的过程加载。另一种方法是在调用`np.random.permutation()`之前，设置随机数生成器的种子（比如`np.random.seed(42)`），以产生总是相同的洗牌指数（shuffled indices）。

但是如果数据集更新，这两个方法都会失效。一个通常的解决办法是使用每个实例的 ID 来判定这个实例是否应该放入测试集（假设每个实例都有唯一并且不变的 ID）。

#### 分层采样

例如，美国人口的 51.3% 是女性，48.7% 是男性。所以在美国，严谨的调查需要保证样本也是这个比例：513 名女性，487 名男性。这称作分层采样（stratified sampling）：将人群分成均匀的子分组，称为分层，从每个分层去取合适数量的实例，以保证测试集对总人数有代表性。







